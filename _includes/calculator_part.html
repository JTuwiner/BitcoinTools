<div class="calculator-row-wrapper">
  <div class="calculator_box">

    <div class="half-section-calc-grid">
      <div class="half-section-calc">
        <div class="lifted-up">
          <div class="calc-label">
            <span>Hash Rate</span>
            {% include tooltip.html text="A measure of the computational power per second used when mining. Simply stated, it is the speed of mining." position="top" %}
          </div>
        </div>
        <img src="https://buybitcoinworldwide.com/pages/img/hash-rate-input-icon.png" alt="hash rate" class="calc-input-icon less-top-margin">
        <input id="hash_rate" class="input_box no-border hash-rate-input">
      </div>
      <div id="customSelect" class="custom-select select_wrapper">
        <select id="unit_select" class="select_box select">
          <option value="t">TH/s</option>
          <option value="g">GH/s</option>
        </select>
      </div>
    </div>

    <div class="half-section-calc">
      <div class="calc-label">
        Bitcoin Price ($)
        {% include tooltip.html text="The live price of Bitcoin as of this second. The price changes frequently and impacts the profitability of bitcoin mining." position="top" %}
      </div>
      <img src="https://buybitcoinworldwide.com/pages/img/bitcoin-price-input-icon.png" alt="bitcoin price" class="calc-input-icon">
      <input id="bitcoin_price" class="input_box bitcoin-price-input">
    </div>

    <div class="half-section-calc new-calc-break">
      <div class="calc-label">
        Power consumption (watts)
        {% include tooltip.html text="The amount of power the whole system is drawing measured in watts. This will be used to calculate the overall electricity cost of the system." position="top" %}
      </div>
      <img src="https://buybitcoinworldwide.com/pages/img/power-consumption-input-icon.png" alt="power consumption" class="calc-input-icon">
      <input id="power_consumption" class="input_box power-consumption-input">
    </div>

    <div class="half-section-calc">
      <div class="calc-label">
        Cost per KW/h in $
        {% include tooltip.html text="The cost to mine Bitcoin per kilowatt hours of electricity." position="top" %}
      </div>
      <img src="https://buybitcoinworldwide.com/pages/img/price-input-icon.png" alt="price" class="calc-input-icon">
      <input id="cost_kw" class="input_box cost-input">
    </div>
  </div>

  <div class="calculator-results-wrapper">
    <div class="positive-earning">
      <div class="profit"><span id="d_day" class="show_box">0</span><br><span class="data-label">Profit / day</span></div>
      <div class="earnings">
        <img src="https://buybitcoinworldwide.com/img/mining-money-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          $<span id="earned_dollar_day" class="show_box">0</span>
          <br>
          <span class="data-label">Mined/day</span>
        </div>
      </div>
      <div class="earnings">
        <img src="https://buybitcoinworldwide.com/img/mining-bitcoin-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          <span id="earned_btc_day" class="show_box">0
          </span>
          <br>
          <span class="data-label">BTC Mined/day</span>
        </div>
      </div>
      <div class="electricity">
        <img src="https://buybitcoinworldwide.com/img/mining-electricity-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          $<span id="ele_costs_day" class="show_box">0</span>
          <br>
          <span class="data-label">Electricity costs/day</span>
        </div>
      </div>
    </div>

    <div class="positive-earning">
      <div class="profit"><span id="d_month" class="show_box">0</span> <br><span class="data-label">Profit / month</span>
      </div>
      <div class="earnings">
        <img src="https://buybitcoinworldwide.com/img/mining-money-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          $<span id="earned_dollar_month" class="show_box">0</span>
          <br>
          <span class="data-label">Mined/month</span>
        </div>
      </div>
      <div class="earnings">
        <img src="https://buybitcoinworldwide.com/img/mining-bitcoin-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          <span id="earned_btc_month" class="show_box">0</span>
          <br>
          <span class="data-label">BTC Mined/month</span>
        </div>
      </div>
      <div class="electricity">
        <img src="https://buybitcoinworldwide.com/img/mining-electricity-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          $<span id="ele_costs_month" class="show_box">0</span>
          <br>
          <span class="data-label">Electricity costs/month</span>
        </div>
      </div>
    </div>

    <div class="positive-earning">
      <div class="profit"><span id="d_year" class="show_box">0</span><br><span class="data-label">Profit / year</span>
      </div>
      <div class="earnings">
        <img src="https://buybitcoinworldwide.com/img/mining-money-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          $<span id="earned_dollar_year" class="show_box">0</span>
          <br>
          <span class="data-label">Mined/year</span>
        </div>
      </div>
      <div class="earnings">
        <img src="https://buybitcoinworldwide.com/img/mining-bitcoin-icon.png" role="presentation" class="results-icon">
          <div class="results-right-col">
          <span id="earned_btc_year" class="show_box">0</span>
          <br>
          <span class="data-label">BTC Mined/year</span>
        </div>
      </div>
      <div class="electricity">
        <img src="https://buybitcoinworldwide.com/img/mining-electricity-icon.png" role="presentation" class="results-icon">
        <div class="results-right-col">
          $
          <span id="ele_costs_year" class="show_box">0</span>
          <br>
          <span class="data-label">Electricity costs/year</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  var height;
  jQuery(document).ready(function ($) {
    var hashrate;
    var earned_day = 0;
    var earned_month = 0;
    var earned_year = 0;
    var ele_day = 0;
    var ele_month = 0;
    var ele_year = 0;

    // $.getJSON("https://www.satochi.co/latest-hashrate", function( data ) {
    //console.log(data);
    hashrate = 576280000000; 
    var append_html = hashrate.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    $("#cur_hash_rate").append(append_html);
    // });

    $.getJSON("https://www.satochi.co/latest", function (data) {
      //console.log(data.Price);
      b = data.Price.toFixed(2).split(".");
      b[0] = b[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
      c = b.join('.');
      $("#bitcoin_price").val(c);
    });

    function stringToTS(s) {
      b = s.toString().split(".");
      b[0] = b[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
      c = b.join('.');
      return c;
    }

    function getValueForYear(v) {
      var t = 0;
      for (i = 0; i < 12; i++) {
        v *= 0.8732584107;
        t += v;
      }
      return t;
    }

    function getAppendHTML(v1, v2) {
      var append_html = "";
      if (v1 >= v2) {
        $(".negative-earning").attr('class', 'positive-earning');
        append_html += "+$" + stringToTS((v1 - v2).toFixed(2));
      } else {
        $(".positive-earning").attr('class', 'negative-earning');
        append_html += "-$" + stringToTS((v2 - v1).toFixed(2));
      }
      return append_html;
    }

    function setDValue_Style() {
      jQuery("#d_day").html(getAppendHTML(earned_day, ele_day));
      jQuery("#d_month").html(getAppendHTML(earned_month, ele_month));
      jQuery("#d_year").html(getAppendHTML(earned_year, ele_year));
    }

    var eventCalc1Handler = function () {
      //s = parseFloat(jQuery("#hash_rate").val().toString().replace(/\,/g,''));
      //jQuery("#hash_rate").val(s);
      var unit = 1;
      var sel_index = document.getElementById("unit_select").selectedIndex;
      if (document.getElementById("unit_select").options[sel_index].value == "t") unit = 1000;

      s = jQuery("#hash_rate").val().toString().replace(/\,/g, '');
      jQuery("#hash_rate").val(stringToTS(s));

      price = jQuery("#bitcoin_price").val().toString().replace(/\,/g, '');
      jQuery("#bitcoin_price").val(stringToTS(price));

      uhr = s / hashrate * unit;

      if (isNaN(uhr)) {
        jQuery("#user_hash_rate").html("0");
        jQuery("#chance").html("0");
        jQuery("#earned_btc_day").html("0");
        jQuery("#earned_btc_month").html("0");
        jQuery("#earned_dollar_day").html("0");
        jQuery("#earned_dollar_month").html("0");
        earned_day = 0;
        earned_month = 0;
        earned_month = 0;
      } else {
        q = uhr.toFixed(8);
        console.log('q: ', q);
        jQuery("#user_hash_rate").html(stringToTS(q));

        uhr *= 144;
        jQuery("#chance").html(stringToTS(uhr.toFixed(8)));

        uhr *= 3.125;
        //jQuery("#earned_btc_day").html(stringToTS(uhr.toFixed(8)));
        //jQuery("#earned_dollar_day").html(stringToTS((uhr * price).toFixed(2)));

        uhr *= 30;
        //jQuery("#earned_btc_month").html(stringToTS(uhr.toFixed(8)));
        //jQuery("#earned_dollar_month").html(stringToTS((uhr * price).toFixed(2)));

        uhr = getValueForYear(uhr);
        earned_day = uhr / 365 * price;
        earned_month = uhr / 12 * price;
        earned_year = uhr * price;

        jQuery("#earned_btc_year").html(stringToTS(uhr.toFixed(4)));
        jQuery("#earned_dollar_year").html(stringToTS(earned_year.toFixed(2)));
        jQuery("#earned_btc_day").html(stringToTS((uhr / 365).toFixed(4)));
        jQuery("#earned_dollar_day").html(stringToTS(earned_day.toFixed(2)));
        jQuery("#earned_btc_month").html(stringToTS((uhr / 12).toFixed(4)));
        jQuery("#earned_dollar_month").html(stringToTS(earned_month.toFixed(2)));
        //jQuery("#earned_btc_year").html(stringToTS((uhr > 0.01) ? uhr.toFixed(3) : uhr.toFixed(5)));
        //jQuery("#earned_btc_day").html(stringToTS(((uhr/365) > 0.01) ? (uhr/365).toFixed(3) : (uhr/365).toFixed(5)));
        //jQuery("#earned_btc_month").html(stringToTS(((uhr/12) > 0.01) ? (uhr/12).toFixed(3) : (uhr/12).toFixed(5)));
      }

      setDValue_Style();
    }

    var eventCalc2Hander = function () {
      //s = parseFloat(jQuery("#hash_rate").val().toString().replace(/\,/g,''));
      //jQuery("#hash_rate").val(s);
      p = jQuery("#power_consumption").val().toString().replace(/\,/g, '');
      jQuery("#power_consumption").val(stringToTS(p));

      c = jQuery("#cost_kw").val().toString().replace(/\,/g, '');
      jQuery("#cost_kw").val(stringToTS(c));

      ec = p / 1000 * 24 * c;
      if (isNaN(ec)) {
        jQuery("#ele_costs_day").html("0");
        jQuery("#ele_costs_month").html("0");
        jQuery("#ele_costs_year").html("0");
        ele_day = 0;
        ele_month = 0;
        ele_year = 0;
      } else {
        q = ec.toFixed(2);
        jQuery("#ele_costs_day").html(stringToTS(q));

        ec *= 30;
        q = ec.toFixed(2);
        jQuery("#ele_costs_month").html(stringToTS(q));

        ec *= 12;
        q = ec.toFixed(2);
        jQuery("#ele_costs_year").html(stringToTS(q));

        ele_year = ec;
        ele_month = ec / 12;
        ele_day = ec / 12 / 30;
      }

      setDValue_Style()
    }

    jQuery("#hash_rate").bind('input', eventCalc1Handler);
    jQuery("#bitcoin_price").bind('input', eventCalc1Handler);
    jQuery("#unit_select").bind('change', eventCalc1Handler);

    jQuery("#power_consumption").bind('input', eventCalc2Hander);
    jQuery("#cost_kw").bind('input', eventCalc2Hander);
  });
</script>

<script>
  var x, i, j, l, ll, selElmnt, a, b, c;
  const customSelect = document.getElementById("customSelect");
  customSelect.addEventListener("click", function (e) {
    e.classList.toggle("select-arrow-active");
  });
  /* Look for any elements with the class "custom-select": */
  x = document.getElementsByClassName("custom-select");
  l = x.length;
  for (i = 0; i < l; i++) {
    selElmnt = x[i].getElementsByTagName("select")[0];
    ll = selElmnt.length;
    /* For each element, create a new DIV that will act as the selected item: */
    a = document.createElement("DIV");
    a.setAttribute("class", "select-selected");
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    x[i].appendChild(a);
    /* For each element, create a new DIV that will contain the option list: */
    b = document.createElement("DIV");
    b.setAttribute("class", "select-items select-hide");
    for (j = 0; j < ll; j++) {
      /* For each option in the original select element,
      create a new DIV that will act as an option item: */
      c = document.createElement("DIV");
      c.innerHTML = selElmnt.options[j].innerHTML;
      c.addEventListener("click", function (e) {
        /* When an item is clicked, update the original select box,
        and the selected item: */
        var y, i, k, s, h, sl, yl;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        sl = s.length;
        h = this.parentNode.previousSibling;
        for (i = 0; i < sl; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            yl = y.length;
            for (k = 0; k < yl; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            break;
          }
        }
        h.click();
      });
      b.appendChild(c);
    }
    x[i].appendChild(b);
    a.addEventListener("click", function (e) {
      /* When the select box is clicked, close any other select boxes,
      and open/close the current select box: */
      e.stopPropagation();
      customSelect.classList.toggle("select-arrow-active");
      this.nextSibling.classList.toggle("select-hide");
      this.classList.toggle("select-arrow-active");
    });
  }

</script>
